---
export const prerender = false
import groq from 'groq'
import { sanity } from '../../lib/sanity'
import { toHTML } from '@portabletext/to-html'
import BaseLayout from '../../layouts/BaseLayout.astro'
import { getSettings } from '../../lib/getSettings'

const { lang } = Astro.params
const LANGS = new Set(['fr','es','en'])
if (!lang || !LANGS.has(lang)) return Astro.redirect('/fr')

const q = groq`{
  "page": coalesce(
    *[_type=="legalPage" && language==$lang && slug.current=="a-propos"][0],
    *[_type=="legalPage" && language=="fr"  && slug.current=="a-propos"][0]
  ){ title, body }
}`
const data = await sanity.fetch(q, { lang })
const settings = await getSettings(lang as 'fr'|'es'|'en')
const html = toHTML(data?.page?.body || [])
---

<BaseLayout lang={lang as any} title={data?.page?.title || 'Ã€ propos'} settings={settings}>
  <div set:html={html}></div>
</BaseLayout>
